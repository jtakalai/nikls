<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nikls is kinda like scred</title>

<script>

var backend = "http://localhost:8081/v0/";
var acceptJson = new Headers({"Accept": "application/json"});
var sendJson = new Headers({"Content-Type": "application/json"});
var getOpts = {method: "GET", headers: acceptJson};


function formatTransaction(t) {
    var desc = t.time;
    t.balances.forEach(function(b) {
	desc += "  " + b.account + ":" + b.balance;
    });
    return desc;
}

function update() {
    fetch(backend+'transaction', getOpts)
    .then(function(r) {
	return r.json();
    })
    .then(function(ts) {
	var ul = document.getElementById("transactions");
	while (ul.firstChild) {
	    ul.removeChild(ul.firstChild);
	}
	console.log(ts);
	ts.forEach(function(t) {
	    var li = document.createElement("li");
	    li.appendChild(document.createTextNode(formatTransaction(t)));
	    ul.appendChild(li);
	});
    });
}

function add() {
    var data = document.getElementById("add").value;
    fetch(backend+'transaction', {method: "POST",
				  headers: sendJson,
				  body: data})
    .then(function(r) {
	return r.text();
    })
    .then(function(status) {
	console.log("STATUS", status);
	document.getElementById("status").textContent = status;
	update();
    })
    .catch(function(err) {
	console.log("ERROR", err);
	document.getElementById("status").textContent = err;
    });
}

update()

</script>

</head>

<body>

  <h1>All transactions:</h1>
  <ul id="transactions"></ul>
  <h2>Add transaction</h1>
  <input id="add" /><button onclick="add()">Add</button>
  <p>Status: <span id="status"></span></p>

</body>
</html>
